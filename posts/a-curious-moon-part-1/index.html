<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> A Curious Moon - Part 1 | Ash Midgley</title>
  <meta name="description" content="Full stack web developer based in Wellington, New Zealand.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="A Curious Moon - Part 1" />
<meta property="og:description" content="I remember my database paper at uni. It was cool. 1pm lectures, Small data sets and clean input data. &ldquo;I can&rsquo;t wait to start working with some real data in a big application&rdquo; I thought to myself as I walked away from Owheo lab for the last time.
Fast forward to my first dev job:
&ldquo;Any idea why SQL Server is down?&rdquo;
SQL what?
&ldquo;Just use an aggregate function to get the count of x&rdquo;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ashmidgley.github.io/posts/a-curious-moon-part-1/" />
<meta property="article:published_time" content="2019-08-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-08-21T00:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="A Curious Moon - Part 1"/>
<meta name="twitter:description" content="I remember my database paper at uni. It was cool. 1pm lectures, Small data sets and clean input data. &ldquo;I can&rsquo;t wait to start working with some real data in a big application&rdquo; I thought to myself as I walked away from Owheo lab for the last time.
Fast forward to my first dev job:
&ldquo;Any idea why SQL Server is down?&rdquo;
SQL what?
&ldquo;Just use an aggregate function to get the count of x&rdquo;"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://ashmidgley.github.io/css/style-classic.css">
  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://ashmidgley.github.io/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/posts">All posts</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://ashmidgley.github.io/posts/pilot/">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://ashmidgley.github.io/posts/a-curious-moon-part-2/">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&text=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&title=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&is_video=false&description=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=A%20Curious%20Moon%20-%20Part%201&body=Check out this article: https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&title=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&title=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&title=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-stumbleupon " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://digg.com/submit?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&title=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-digg " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&name=A%20Curious%20Moon%20-%20Part%201&description=I%20remember%20my%20database%20paper%20at%20uni.%20It%20was%20cool.%201pm%20lectures%2c%20Small%20data%20sets%20and%20clean%20input%20data.%20%26ldquo%3bI%20can%26rsquo%3bt%20wait%20to%20start%20working%20with%20some%20real%20data%20in%20a%20big%20application%26rdquo%3b%20I%20thought%20to%20myself%20as%20I%20walked%20away%20from%20Owheo%20lab%20for%20the%20last%20time.%0aFast%20forward%20to%20my%20first%20dev%20job%3a%0a%26ldquo%3bAny%20idea%20why%20SQL%20Server%20is%20down%3f%26rdquo%3b%0aSQL%20what%3f%0a%26ldquo%3bJust%20use%20an%20aggregate%20function%20to%20get%20the%20count%20of%20x%26rdquo%3b">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&t=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        A Curious Moon - Part 1
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2019-08-21 00:00:00 &#43;0000 UTC" itemprop="datePublished">2019-08-21</time>
          
        </div>
        
        
      </div>
    </header>

  
    <div class="content" itemprop="articleBody">
      <p>I remember my database paper at uni. It was cool. 1pm lectures, Small data sets and clean input data. &ldquo;I can&rsquo;t wait to start working with some real data in a big application&rdquo; I thought to myself as I walked away from Owheo lab for the last time.</p>
<p>Fast forward to my first dev job:</p>
<p>&ldquo;Any idea why SQL Server is down?&rdquo;</p>
<p>SQL what?</p>
<p>&ldquo;Just use an aggregate function to get the count of x&rdquo;</p>
<p>Huh?</p>
<p>&ldquo;Be a doll and write us a window function to show x, y and z&rdquo;</p>
<p><em>Slowly climbs under desk and gets into fetal position.</em></p>
<p>I had a bad case of Databaseitis. I needed a remedy. So I read <a href="https://bigmachine.io/products/a-curious-moon">A Curious Moon</a> by Rob Conery. Below is a brain dump of things I wrote at the time. It contains a bunch of excerpts from the book.</p>
<p>Let&rsquo;s dive on in.</p>
<p><img src="/assets/images/point-break.jpg" alt="Skydive"></p>
<h4 id="sql">SQL</h4>
<p>Stands for Structured Query Language. It&rsquo;s a language used to work with data in databases.</p>
<h4 id="rdbms">RDBMS</h4>
<p>Relational Database Management system. A kind of system assumes there are relations between the different sets of data (tables). Examples: PostgreSQL, Microsoft SQL Server (MSSQL), MySQL.</p>
<h4 id="nosql">NoSQL</h4>
<p>Database system&rsquo;s that do not have relational data. Increasingly being used in big data and real-time web applications. Examples: MongoDB, Cassandra, Redis.</p>
<h4 id="idempotent-script">Idempotent script</h4>
<p>A script that you can run multiple times and it will always run, with the same result.</p>
<pre><code>drop table if exists example_table
</code></pre><p>If you re-run the query it will remove the previous table created, making the script idempotent.</p>
<h4 id="psql">psql</h4>
<p>PostgreSQL command line interface.</p>
<h4 id="make">Make</h4>
<p>Makefile&rsquo;s define a set of tasks to be executed that generate a target/build. Very handy for automating the execution of multiple scripts. Example from the book <a href="https://github.com/red-4/curious-moon/blob/master/01-enceladus_db/Makefile">here</a>.</p>
<h4 id="joins">Joins</h4>
<p>Allow us to combine data from 2 different data sets (tables). In SQL, there are 4 basic types of joins:</p>
<ul>
<li>Inner</li>
<li>Left</li>
<li>Right</li>
<li>Full</li>
</ul>
<p>The easiest way for me to visualize different join&rsquo;s is with <a href="https://www.sql-join.com/sql-join-types/">venn diagrams</a>.</p>
<h4 id="primary-keys">Primary keys</h4>
<p>Uniquely identifies each row in a table.</p>
<pre><code>add id serial primary key;
</code></pre><h4 id="foreign-keys">Foreign keys</h4>
<p>Table value that references a primary key in another table. This allows us to link/establish a relationship between 2 tables.</p>
<pre><code>add example_id int references example_table(id);
</code></pre><h4 id="schemas">Schemas</h4>
<p>Database structures can be grouped into schema&rsquo;s for different uses. Creating schema&rsquo;s can be useful for manipulating data that you don&rsquo;t want in the public schema.</p>
<blockquote>
<p>&ldquo;I’ve been dumping raw CSV data into my public schema, which, yeah, seems kind of goofy. In programming terms, I suppose this could be like the master branch in Git, the public directory in Rails or the global namespace in client-side JavaScript.&rdquo;</p>
</blockquote>
<p>Example: using an import schema before tidying up the data and moving it to the public schema.</p>
<pre><code>create schema if not exists import;
create table import.example_table (
 ...
)
</code></pre><h4 id="normalization">Normalization</h4>
<p>Used to reduce repetition in a database so we take up less disk space and can perform operations quicker. There are several forms. The general rule is that a relation is normalized if it meets the third normal form (3NF). Most of the time we create lookup tables to normalize a relation and replace the values in the &lsquo;source&rsquo; table with the primary keys from these lookup tables.</p>
<h4 id="lookup-tables">Lookup tables</h4>
<p>To create a lookup table:</p>
<ol>
<li>Get all the distinct values for a column in the table.</li>
<li>Create a new table using this data.</li>
<li>Add a primary key for each entry. This value will replace the value in the original &lsquo;source&rsquo; table.</li>
</ol>
<p>Say we have a source table which holds data for transactions for a food stand:</p>
<pre><code>id | customer_id | order
-------------------
1 | 2 | 'Pickle sandwich'
2 | 5 | 'Ham baguette'
3 | 7 | 'Pickle sandwich'
4 | 8 | 'Snag'
5 | 2 | 'Pickle sandwich'
</code></pre><p>We could create a lookup table for orders to remove repeated text values:</p>
<pre><code>id | description
-------------------
1 | 'Pickle sandwich'
2 | 'Ham baguette'
3 | 'Snag'
</code></pre><p>And alter the source table to become:</p>
<pre><code>id | customer_id | order_id
-------------------
1 | 2 | 1
2 | 5 | 2
3 | 7 | 1
4 | 8 | 3
5 | 2 | 1
</code></pre><h4 id="etl">ETL</h4>
<p>Stands for extract, transform and load. It&rsquo;s a process used when we want to take data from another system and load it into our database.</p>
<blockquote>
<p>&ldquo;ETL is about pulling, prepping and loading a ton of data. It&rsquo;s mind numbing, tedious, and incredibly rewarding one you get to play with the data that you&rsquo;ve loaded.&rdquo;</p>
</blockquote>
<h4 id="extraction">Extraction</h4>
<p>Pretty straight forward compared to transformation and load. It&rsquo;s just the process of pulling relevant data out of the various systems.</p>
<h4 id="transformation">Transformation</h4>
<p>Cleaning up the extracted data so it&rsquo;s ready to be dumped into our database. This involves handling bogus values or data that isn&rsquo;t in the correct format.</p>
<p>You need to make sure of 3 things:</p>
<ul>
<li>We have correct typing. Example: seeing &lsquo;-&rsquo; in place of a number.</li>
<li>Completeness. Data may need to be thrown out because it is incomplete or because we can&rsquo;t handle the typing.</li>
<li>Accuracy. Example: say we have a column for values in degrees. Any values below 0 or over 360 would be incorrect.</li>
</ul>
<blockquote>
<p>&ldquo;This is the most involved part of the ETL process. The last thing we want to do is to make data incorrect while trying to correct it. Our goal is correct, complete, accurate data&rdquo;</p>
</blockquote>
<h4 id="load">Load</h4>
<p>Pushing the transformed data into our normalized database tables. Typically we can use shell scripts and Make files for this. With large data sets you may need to use other tools but I haven&rsquo;t explored these.</p>
<blockquote>
<p>&ldquo;Import everything as text. Add types later on. You want the data in the database first, everything else can wait.&rdquo;</p>
</blockquote>
<pre><code>COPY import.example_table 
FROM '/path/to/csv/.../example.csv' 
WITH DELIMITER ',' HEADER CSV;
</code></pre><h4 id="index">Index</h4>
<p>A type of data structure that helps us retrieve data faster. They mean we don&rsquo;t have to search every row in a table when that table is accessed. It comes with the cost of extra writes and storage space.</p>
<blockquote>
<p>&ldquo;I do know about indexes. They work just like their analog that you would find in the back of a book. You find the term you’re looking for by using an alphabetical lookup and then head to a given page. Much faster than scanning every single page for a term, no?&rdquo;</p>
</blockquote>
<pre><code>create index idx_example_search
on example_table using GIN(search);
</code></pre><p>To be continued&hellip;</p>

    </div>
  </article>

  
  





  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/posts">All posts</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&text=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&title=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&is_video=false&description=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=A%20Curious%20Moon%20-%20Part%201&body=Check out this article: https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&title=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&title=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&title=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://digg.com/submit?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&title=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-digg fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&name=A%20Curious%20Moon%20-%20Part%201&description=I%20remember%20my%20database%20paper%20at%20uni.%20It%20was%20cool.%201pm%20lectures%2c%20Small%20data%20sets%20and%20clean%20input%20data.%20%26ldquo%3bI%20can%26rsquo%3bt%20wait%20to%20start%20working%20with%20some%20real%20data%20in%20a%20big%20application%26rdquo%3b%20I%20thought%20to%20myself%20as%20I%20walked%20away%20from%20Owheo%20lab%20for%20the%20last%20time.%0aFast%20forward%20to%20my%20first%20dev%20job%3a%0a%26ldquo%3bAny%20idea%20why%20SQL%20Server%20is%20down%3f%26rdquo%3b%0aSQL%20what%3f%0a%26ldquo%3bJust%20use%20an%20aggregate%20function%20to%20get%20the%20count%20of%20x%26rdquo%3b">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fashmidgley.github.io%2fposts%2fa-curious-moon-part-1%2f&t=A%20Curious%20Moon%20-%20Part%201">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2020  Ash Midgley 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/posts">All posts</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>



</html>
